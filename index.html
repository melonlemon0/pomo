<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë½€ëª¨ ì‹¤ì‹œê°„ íƒ€ì´ë¨¸ ğŸ…</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      background: radial-gradient(circle at top, #fff4e6, #ffeef7);
    }

    .app {
      width: 100%;
      max-width: 720px;
      margin: 24px 12px;
      background: #ffffffcc;
      border-radius: 20px;
      padding: 20px 18px 18px;
      box-shadow: 0 16px 40px rgba(0, 0, 0, 0.12);
      backdrop-filter: blur(12px);
      border: 1px solid #ffd6e0;
    }

    h1 {
      margin: 0 0 4px;
      font-size: 1.7rem;
      text-align: center;
    }

    .subtitle {
      text-align: center;
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 14px;
    }

    .hidden {
      display: none;
    }

    .screen {
      margin-top: 8px;
    }

    /* ì´ë¦„ ì„ íƒ í™”ë©´ */
    .section-title {
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 6px;
    }

    #nameSearch {
      width: 100%;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid #e3d7ff;
      font-size: 0.9rem;
      outline: none;
      margin-bottom: 10px;
      background: #faf7ff;
    }

    #nameSearch:focus {
      border-color: #ff9ecb;
      box-shadow: 0 0 0 3px rgba(255, 158, 203, 0.25);
      background: #fff;
    }

    .name-list {
      max-height: 360px;
      overflow-y: auto;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 6px;
    }

    .name-btn {
      border-radius: 999px;
      border: 1px solid #f0e4ff;
      padding: 6px 10px;
      font-size: 0.85rem;
      text-align: left;
      background: #ffffff;
      cursor: pointer;
      transition: background 0.15s, box-shadow 0.15s, transform 0.1s,
        border-color 0.15s;
    }

    .name-btn:hover {
      background: #fff4f9;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.07);
      transform: translateY(-1px);
    }

    .name-btn.selected {
      background: #ffe1f1;
      border-color: #ff9ecb;
      box-shadow: 0 0 0 2px rgba(255, 158, 203, 0.35);
    }

    .primary-btn,
    .secondary-btn {
      border: none;
      border-radius: 999px;
      padding: 9px 14px;
      font-size: 0.9rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      font-weight: 600;
      transition: transform 0.08s, box-shadow 0.08s, opacity 0.08s;
    }

    .primary-btn {
      background: linear-gradient(135deg, #ff9ecb, #ffd884);
      color: #4b2530;
      box-shadow: 0 8px 16px rgba(255, 140, 184, 0.5);
    }

    .secondary-btn {
      background: #f4ecff;
      color: #5a4a7a;
      box-shadow: 0 4px 10px rgba(90, 74, 122, 0.15);
    }

    .primary-btn:hover,
    .secondary-btn:hover {
      transform: translateY(-1px);
    }

    .primary-btn:active,
    .secondary-btn:active {
      transform: translateY(0);
      box-shadow: none;
      opacity: 0.9;
    }

    .name-footer {
      margin-top: 10px;
      text-align: right;
      font-size: 0.8rem;
      color: #888;
    }

    /* íƒ€ì´ë¨¸ í™”ë©´ */
    .timer-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .current-name {
      font-size: 0.9rem;
      color: #444;
    }

    .phase-label {
      font-size: 0.9rem;
      font-weight: 600;
      padding: 4px 10px;
      border-radius: 999px;
      background: #e5f6ff;
      color: #15536b;
    }

    .phase-label.study {
      background: #ffe5ef;
      color: #8c2649;
    }

    .phase-label.break {
      background: #e6ffe8;
      color: #166434;
    }

    .timer-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 10px 0 14px;
    }

    .timer-circle {
      width: 260px;
      height: 260px;
      border-radius: 50%;
      border: 4px solid #ffcfe0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #fffaf4, #ffeaf5);
      box-shadow: 0 12px 30px rgba(255, 140, 184, 0.6);
      position: relative;
    }

    .timer-text {
      font-size: 3rem;
      font-weight: 700;
      color: #333;
    }

    .timer-sub {
      font-size: 0.9rem;
      color: #777;
      margin-top: 4px;
      text-align: center;
    }

    .timer-controls {
      display: flex;
      gap: 10px;
      margin-top: 12px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .status-line {
      margin-top: 8px;
      font-size: 0.85rem;
      color: #777;
      min-height: 18px;
      text-align: center;
    }

    .active-names-section {
      margin-top: 14px;
    }

    .active-title {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .active-names {
      min-height: 40px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .active-chip {
      border-radius: 999px;
      padding: 5px 10px;
      font-size: 0.85rem;
      background: #fff4fa;
      border: 1px solid #ffd6e8;
    }

    .active-chip.me {
      background: #ffe4f2;
      border-color: #ff9ecb;
      font-weight: 600;
    }

    .hint-line {
      font-size: 0.78rem;
      color: #999;
      margin-top: 6px;
    }

    @media (max-width: 600px) {
      .app {
        margin: 16px 8px;
        padding: 16px 12px 14px;
      }

      .timer-circle {
        width: 220px;
        height: 220px;
      }

      .timer-text {
        font-size: 2.4rem;
      }

      .name-list {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>ë½€ëª¨ ì‹¤ì‹œê°„ íƒ€ì´ë¨¸ ğŸ…</h1>
    <div class="subtitle">
      ì •ê° / 30ë¶„ì— ê°™ì´ 25ë¶„ ê³µë¶€ + 5ë¶„ ì‰¬ëŠ” íƒ€ì´ë¨¸ ğŸ’ª
    </div>

    <!-- ì´ë¦„ ì„ íƒ í™”ë©´ -->
    <div id="name-screen" class="screen">
      <div class="section-title">1. ì´ë¦„ ì„ íƒí•˜ê¸°</div>
      <input
        id="nameSearch"
        type="text"
        placeholder="ì´ë¦„ ë˜ëŠ” ì´ëª¨ì§€ ê²€ìƒ‰..."
      />
      <div id="nameList" class="name-list"></div>
      <div class="name-footer">
        ì„ íƒ í›„ &ldquo;íƒ€ì´ë¨¸ë¡œ ê°€ê¸°&rdquo; ë²„íŠ¼ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš” :)
      </div>
      <div style="margin-top: 10px; text-align: center;">
        <button id="goTimerBtn" class="primary-btn">
          â± íƒ€ì´ë¨¸ë¡œ ê°€ê¸°
        </button>
      </div>
    </div>

    <!-- íƒ€ì´ë¨¸ í™”ë©´ -->
    <div id="timer-screen" class="screen hidden">
      <div class="timer-header">
        <div class="current-name">
          í˜„ì¬ ì ‘ì†: <span id="currentName"></span>
        </div>
        <div class="phase-label" id="phaseLabel">ê³„ì‚° ì¤‘...</div>
        <button id="changeNameBtn" class="secondary-btn">
          ğŸ”„ ì´ë¦„ ë³€ê²½
        </button>
      </div>

      <div class="timer-wrapper">
        <div class="timer-circle">
          <div class="timer-text" id="timerDisplay">--:--</div>
        </div>
        <div class="timer-sub" id="timerSubText">
          ì •ê°/30ë¶„ ê¸°ì¤€ìœ¼ë¡œ ìë™ìœ¼ë¡œ ë§ì¶°ì§‘ë‹ˆë‹¤.
        </div>
        <div class="timer-controls">
          <button id="startBtn" class="primary-btn">
            â–¶ï¸ ì‹œì‘í•˜ê¸° (ê³µë¶€ ì¤‘ í‘œì‹œ)
          </button>
          <button id="stopBtn" class="secondary-btn">
            â¹ ëë‚´ê¸° (ê³µë¶€ ì¢…ë£Œ)
          </button>
        </div>
        <div class="status-line" id="statusLine"></div>
      </div>

      <div class="active-names-section">
        <div class="active-title">ì§€ê¸ˆ ê°™ì´ ê³µë¶€ ì¤‘ì¸ ë½€ëª¨ ë©¤ë²„ ğŸ…</div>
        <div id="activeNames" class="active-names"></div>
        <div class="hint-line">
          â€» &ldquo;ì‹œì‘í•˜ê¸°&rdquo;ë¥¼ ëˆ„ë¥´ë©´ ì´ë¦„ì´ ë‚˜íƒ€ë‚˜ê³ , &ldquo;ëë‚´ê¸°&rdquo;ë¥¼ ëˆ„ë¥´ë©´ ì‚¬ë¼ì§‘ë‹ˆë‹¤.
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

    // --- 1. Supabase ì„¤ì • (ë‹¹ì‹  í”„ë¡œì íŠ¸) ---
    const SUPABASE_URL = "https://upiobealvympxbypfmkc.supabase.co";
    const SUPABASE_ANON_KEY =
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVwaW9iZWFsdnltcHhieXBmbWtjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzNzYxNDIsImV4cCI6MjA3ODk1MjE0Mn0.mLvGyy-eMWr-ow2b2USMg7PXKq2EUfK1fyJEsdGThKw";

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // --- 2. ë½€ëª¨ ë©¤ë²„ ëª©ë¡ ---
    const MEMBERS = [
      "ë°•ë¯¸ì„ ğŸ§¶",
      "ê³ ì£¼ì—°ğŸ¬",
      "ë¬¸í•˜ì˜ğŸŒ™",
      "ì „ì€ì„ğŸ•",
      "ì´ì•„ë¡œğŸ°",
      "ê¹€íƒœí›ˆğŸªµ",
      "ë°•ì •í˜„ğŸ¥",
      "ìœ¤ì¥í˜ğŸ¦‡",
      "ê¹€ë¯¼ì§€ğŸšˆ",
      "ì´ì •ì² ğŸŒµ",
      "ê¶Œë„ì´ğŸŸ",
      "ì„ê°€ì˜ğŸ”®",
      "ì •ì„±ìš°ğŸ¥°",
      "ê¹€ì˜ì„œğŸ¾",
      "ìµœë¬¸ì˜ğŸ",
      "ì´ê²½í‘œğŸ«",
      "ê¹€ì„±í™˜ğŸ˜",
      "ì„±ê·œí˜„â™¾ï¸",
      "ë°•ì€ì§€ğŸ¦š",
      "ë°•ì¢…í˜ğŸ·",
      "ê¹€ì •í˜„ğŸ»",
      "ì†¡ì°½í˜¸ğŸª–",
      "ë°•ë¯¼ì„ğŸ›ï¸",
      "ì´ì˜ˆì›ğŸ­",
      "ì¡°ì¬í˜„ğŸ",
      "ì¡°ì„œì˜ğŸ‡¬ğŸ‡§",
      "ê³ ë³‘ì°¬âš½ï¸",
      "ì •ë¯¼ì˜ğŸ¦¦",
      "ì¡°ì„±í˜„ğŸµ",
      "ì´ì§€ì€ğŸ’",
      "í™©ìƒˆë²½ğŸŒ†",
      "ì¡°ì •ë²”ğŸ«’",
      "ë°•ì˜í›ˆğŸ‘»",
      "ê°•ë¯¼ì •ğŸŒ½",
      "ë°•ì¬ì§„ğŸŒŠ",
      "ì´ìŠ¹í˜¸ğŸ²",
      "ê¹€ë¯¼ì •ğŸ¨",
      "ì „í•˜ìœ¤ğŸ§€",
      "ì´ë‚¨ìˆ˜ğŸ‘‡",
      "ê¹€ì€ì„±ğŸ±",
      "ê¹€ì§€í™˜ğŸ”®",
      "ì´ì¬ì›ğŸ’µ",
      "ì •ì—°ìˆ˜ğŸ¦­",
      "ê¹€ë„í›ˆğŸ–ï¸",
      "ì´ê¸ˆë¹„ğŸŒ§",
      "ìµœì§€ì›ğŸ•³",
      "ë°•ë¯¼ê²½ğŸ‰",
      "ê¶Œê·œë²”ğŸ†",
      "ë°•ëŒ€í—ŒğŸ¥‹",
      "ì •ë‹¤í¬ğŸ¿ï¸",
      "ê¹€ì°½í›ˆğŸªŸ",
      "ì¡°ì¶©ì—°ğŸ¦â€ğŸ”¥",
      "ìµœë‹¤ì˜ˆğŸ­",
      "ìµœì„œì˜ğŸ‘",
      "ë…¸ì†Œí˜„ğŸ¢",
      "ë°•ìš°ë¹ˆâ˜”ï¸",
      "ì´ê°€í˜„ğŸ¥",
      "ë°°ì§€ì€ğŸ’",
      "ì •ê³„í›ˆğŸ¥š",
      "ì¸ì¹˜ê´‘ğŸ’¡",
      "ê°•íƒœí›ˆğŸ’ª",
      "ë°•ê²½ì„œğŸŒ…",
      "ë°•ì¤€í‘œğŸ•",
      "ì¡°ì›ì°½ğŸ›¡ï¸",
      "ì§€ìŠ¬ì•„ğŸ§Š",
      "ì°¨ë¯¼êµ¬â™ ï¸",
      "ì–‘ì§„í¬ğŸ‘",
      "ë°•í˜œì—°ğŸŠ",
      "ì„œì›ë‘â˜•ï¸",
      "ì•ˆë³´í˜„ğŸ˜",
      "ìš°ì€ì§€ğŸ’",
      "ê¹€ë¯¼ì„­ğŸ•¶ï¸",
      "ë°•ë¯¸ì„ ğŸ³",
      "ì—¬ì§€ì›ğŸ•¹ï¸",
      "ìœ í˜„ë¹ˆâ˜€ï¸",
      "ì´í˜„ì¤€ğŸ«",
      "ì´í˜„ì§€ğŸ’Œ",
      "í—ˆíƒœì›…ğŸ€",
      "ë¥˜ê²½í˜¸ğŸ‘®",
      "ë°•ë™ê±´â˜„ï¸",
      "ê³ í¬ì›ğŸ˜„",
      "ê¹€ê¸°ì›âšª",
      "ê¹€ì˜ˆì›ğŸ¥",
      "ê¹€ì¤€í˜•ğŸ¤–",
      "ê¹€ì§„ê³¤ğŸ™",
      "ê¹€ì§„ìˆ˜ğŸ’¦",
      "ê¹€íƒœê²½ğŸŒ±",
      "ë¯¼ì§€í˜„ğŸ",
      "ë°±í•˜ìœ¤â„ï¸",
      "ì†¡ì˜í›ˆğŸ’¿",
      "ì–‘ì†Œì—°ğŸŸ",
      "ìœ¤ì‹ í˜œğŸ˜†",
      "ìœ¤ì£¼ì„±ğŸ°",
      "ì´ì¤€í˜¸ğŸ‘£",
      "ì´ì°½í˜„ğŸŒ",
      "ì •ë³‘í˜ğŸ¸",
      "ì •ì˜ˆì€ğŸ§‡",
      "ì •ìœ ë¯¼ğŸ¹",
      "ì¡°ë¯¼ì œğŸ¦",
      "ìµœì˜ì¸ğŸ“€",
      "í•˜ìœ ì²­ğŸ¶",
      "í™ìŠ¹í˜„ğŸ³"
    ];

    // --- 3. DOM ìš”ì†Œ ---
    const nameScreen = document.getElementById("name-screen");
    const timerScreen = document.getElementById("timer-screen");
    const nameListEl = document.getElementById("nameList");
    const nameSearchEl = document.getElementById("nameSearch");
    const goTimerBtn = document.getElementById("goTimerBtn");
    const currentNameEl = document.getElementById("currentName");
    const changeNameBtn = document.getElementById("changeNameBtn");
    const timerDisplay = document.getElementById("timerDisplay");
    const timerSubText = document.getElementById("timerSubText");
    const phaseLabel = document.getElementById("phaseLabel");
    const startBtn = document.getElementById("startBtn");
    const stopBtn = document.getElementById("stopBtn");
    const statusLine = document.getElementById("statusLine");
    const activeNamesEl = document.getElementById("activeNames");

    let selectedName = null;

    // --- 4. ì´ë¦„ ì„ íƒ UI ë§Œë“¤ê¸° ---
    let selectedButton = null;

    function renderNameButtons(filter = "") {
      nameListEl.innerHTML = "";
      const lower = filter.trim().toLowerCase();

      MEMBERS.forEach((name) => {
        if (lower && !name.toLowerCase().includes(lower)) return;

        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "name-btn";
        btn.textContent = name;

        if (selectedName === name) {
          btn.classList.add("selected");
          selectedButton = btn;
        }

        btn.addEventListener("click", () => {
          selectedName = name;
          localStorage.setItem("pomodoroName", selectedName);
          if (selectedButton) selectedButton.classList.remove("selected");
          btn.classList.add("selected");
          selectedButton = btn;
        });

        nameListEl.appendChild(btn);
      });

      if (!nameListEl.innerHTML) {
        nameListEl.innerHTML =
          '<div style="font-size:0.85rem;color:#999;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
      }
    }

    nameSearchEl.addEventListener("input", (e) => {
      renderNameButtons(e.target.value);
    });

    // --- 5. í™”ë©´ ì „í™˜ ---
    function showNameScreen() {
      nameScreen.classList.remove("hidden");
      timerScreen.classList.add("hidden");
      statusLine.textContent = "";
    }

    function showTimerScreen() {
      if (!selectedName) {
        alert("ë¨¼ì € ì´ë¦„ì„ ì„ íƒí•´ ì£¼ì„¸ìš”!");
        return;
      }
      currentNameEl.textContent = selectedName;
      nameScreen.classList.add("hidden");
      timerScreen.classList.remove("hidden");
      statusLine.textContent = "";
      loadActiveMembers();
    }

    goTimerBtn.addEventListener("click", showTimerScreen);

    changeNameBtn.addEventListener("click", () => {
      leaveSession(); // ì´ë¦„ ë°”ê¾¸ë©´ ìë™ìœ¼ë¡œ ì„¸ì…˜ì—ì„œ ë¹ ì§€ê²Œ
      showNameScreen();
    });

    // --- 6. íƒ€ì´ë¨¸ (ì •ê° / 30ë¶„ ê¸°ì¤€ 25+5) ---
    function updateTimer() {
      const now = new Date();
      const m = now.getMinutes();
      const s = now.getSeconds();
      const totalSec = m * 60 + s;

      let nextBoundary;
      let phase; // "study" or "break"

      // ê° ì‹œ(hour) ì•ˆì—ì„œ:
      // 00:00~24:59  ê³µë¶€, 25:00~29:59 ì‰¬ëŠ”ì‹œê°„
      // 30:00~54:59  ê³µë¶€, 55:00~59:59 ì‰¬ëŠ”ì‹œê°„
      if (totalSec < 25 * 60) {
        phase = "study";
        nextBoundary = 25 * 60;
      } else if (totalSec < 30 * 60) {
        phase = "break";
        nextBoundary = 30 * 60;
      } else if (totalSec < 55 * 60) {
        phase = "study";
        nextBoundary = 55 * 60;
      } else {
        phase = "break";
        nextBoundary = 60 * 60;
      }

      const remaining = nextBoundary - totalSec;
      const mm = Math.floor(remaining / 60);
      const ss = remaining % 60;

      const mmStr = String(mm).padStart(2, "0");
      const ssStr = String(ss).padStart(2, "0");
      timerDisplay.textContent = `${mmStr}:${ssStr}`;

      if (phase === "study") {
        phaseLabel.textContent = "ê³µë¶€ ì‹œê°„ ğŸ… (25ë¶„)";
        phaseLabel.classList.add("study");
        phaseLabel.classList.remove("break");
        timerSubText.textContent = "ì •ê°/30ë¶„ ê¸°ì¤€ 25ë¶„ ê³µë¶€ ì¤‘ì…ë‹ˆë‹¤.";
      } else {
        phaseLabel.textContent = "ì‰¬ëŠ” ì‹œê°„ â˜• (5ë¶„)";
        phaseLabel.classList.add("break");
        phaseLabel.classList.remove("study");
        timerSubText.textContent = "5ë¶„ íœ´ì‹ íƒ€ì„! ë¬¼ ë§ˆì‹œê³  ìŠ¤íŠ¸ë ˆì¹­ ğŸŒ¿";
      }
    }

    setInterval(updateTimer, 1000);
    updateTimer();

    // --- 7. Supabase: í˜„ì¬ ê³µë¶€ì¤‘ ë©¤ë²„ ë¶ˆëŸ¬ì˜¤ê¸° ---
    async function loadActiveMembers() {
      const { data, error } = await supabase
        .from("pomodoro_active")
        .select("*")
        .order("joined_at", { ascending: true });

      if (error) {
        console.error("loadActiveMembers error", error);
        statusLine.textContent = "ë©¤ë²„ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤ ğŸ˜¢";
        return;
      }

      renderActiveMembers(data || []);
    }

    function renderActiveMembers(rows) {
      activeNamesEl.innerHTML = "";
      if (!rows.length) {
        activeNamesEl.innerHTML =
          '<span style="font-size:0.85rem;color:#aaa;">ì•„ì§ ì•„ë¬´ë„ ê³µë¶€ë¥¼ ì‹œì‘í•˜ì§€ ì•Šì•˜ì–´ìš”.</span>';
        return;
      }

      rows.forEach((row) => {
        const chip = document.createElement("div");
        chip.className = "active-chip";
        if (row.member_name === selectedName) {
          chip.classList.add("me");
        }
        chip.textContent = row.member_name;
        activeNamesEl.appendChild(chip);
      });
    }

    // --- 8. ì‹œì‘ / ëë‚´ê¸° ---
    async function joinSession() {
      if (!selectedName) {
        alert("ë¨¼ì € ì´ë¦„ì„ ì„ íƒí•´ ì£¼ì„¸ìš”!");
        return;
      }
      statusLine.textContent = "ê³µë¶€ ì‹œì‘ í‘œì‹œ ì¤‘...";

      // ê°™ì€ ì´ë¦„ ì¤‘ë³µ ë°©ì§€: ê¸°ì¡´ í–‰ ì‚­ì œ í›„ ìƒˆë¡œ insert
      await supabase
        .from("pomodoro_active")
        .delete()
        .eq("member_name", selectedName);

      const { error } = await supabase
        .from("pomodoro_active")
        .insert({ member_name: selectedName });

      if (error) {
        console.error("joinSession error", error);
        statusLine.textContent = "ê³µë¶€ ì‹œì‘ì„ í‘œì‹œí•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤ ğŸ˜¢";
        return;
      }
      statusLine.textContent = "ì§€ê¸ˆ ê³µë¶€ ì¤‘ìœ¼ë¡œ í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤ ğŸ’ª";
      loadActiveMembers();
    }

    async function leaveSession() {
      if (!selectedName) return;
      statusLine.textContent = "ê³µë¶€ ì¢…ë£Œ í‘œì‹œ ì¤‘...";

      const { error } = await supabase
        .from("pomodoro_active")
        .delete()
        .eq("member_name", selectedName);

      if (error) {
        console.error("leaveSession error", error);
        statusLine.textContent = "ê³µë¶€ ì¢…ë£Œë¥¼ í‘œì‹œí•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤ ğŸ˜¢";
        return;
      }
      statusLine.textContent = "ê³µë¶€ ì¢…ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤ âœ…";
      loadActiveMembers();
    }

    startBtn.addEventListener("click", joinSession);
    stopBtn.addEventListener("click", leaveSession);

    // --- 9. Realtime: ë‹¤ë¥¸ ì‚¬ëŒ ë³€í™” ì‹¤ì‹œê°„ ë°˜ì˜ ---
    supabase
      .channel("pomodoro_active_channel")
      .on(
        "postgres_changes",
        { event: "*", schema: "public", table: "pomodoro_active" },
        () => {
          loadActiveMembers();
        }
      )
      .subscribe();

    // --- 10. ì´ˆê¸°í™”: localStorageì— ì €ì¥ëœ ì´ë¦„ ë¶ˆëŸ¬ì˜¤ê¸° ---
    function init() {
      const savedName = localStorage.getItem("pomodoroName");
      if (savedName && MEMBERS.includes(savedName)) {
        selectedName = savedName;
      }

      renderNameButtons("");

      if (selectedName) {
        showTimerScreen();
      } else {
        showNameScreen();
      }
    }

    init();
  </script>
</body>
</html>
